<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
  <link th:href="@{/webjars/bootstrap/3.4.1/dist/css/bootstrap.css}" rel="stylesheet"/>
</head>
<body>
  <div class="container">
    <div class="row">
      <div class="col-xs-12 col-sm-12">
        <h2>公司名称：华为电子工程有限公司</h2>
        <h2>型号：TX56 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;光束间距：2mm</h2>
      </div>
    </div>
    <div class="row">
      <div class="col-xs-12 col-sm-12">
        <h4 th:text="${title}"></h4>
        <p>操作:<div><a onclick="openSocket()">开启socket</a></div>
        <p>【操作】：<div><a onclick="sendMessage()">发送消息</a></div>
      </div>
    </div>
  </div>
</body>
<script th:src="@{/webjars/jquery/3.4.1/dist/jquery.js}"></script>
<script th:src="@{/webjars/bootstrap/3.4.1/dist/js/bootstrap.js}"></script>
<script type="application/javascript">
  let socket;
  function openSocket() {
    if (typeof (WebSocket) == "undefined") {
      console.log("您的浏览器不支持WebSocket");
    } else {
      console.log("您的浏览器支持WebSocket");
      //实现化WebSocket对象，指定要连接的服务器地址与端口  建立连接
      let socketUrl = "ws://192.168.0.3:22000/webSocket/serial";
      console.log(socketUrl);
      if (socket != null) {
        socket.close();
        socket = null;
      }
      socket = new WebSocket(socketUrl);
      //打开事件
      socket.onopen = function () {
        console.log("websocket已打开");
        socket.send("这是来自客户端的消息" + location.href + new Date());
      };
      //获得消息事件
      socket.onmessage = function (msg) {
        let serverMsg = "收到服务端信息：" + msg.data;
        console.log(serverMsg);
        //发现消息进入    开始处理前端触发逻辑
      };
      //关闭事件
      socket.onclose = function () {
        console.log("websocket已关闭");
      };
      //发生了错误事件
      socket.onerror = function () {
        console.log("websocket发生了错误");
      }
    }
  }

  function sendMessage() {
    if (typeof (WebSocket) == "undefined") {
      console.log("您的浏览器不支持WebSocket");
    } else {
      // console.log("您的浏览器支持WebSocket");
      let msg = '我是客户端1';
      console.log(msg);
      socket.send(msg);
    }
  }

</script>
</html>
